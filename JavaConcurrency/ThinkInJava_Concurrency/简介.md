## 并发

## 一、并发的多面性

- 并发解决的问题
    - 速度（更快的执行）
        - 一方面可以将一个任务划分为多个处理器并行，加快速度
        - 另一方面因为顺序执行程序可能受到程序控制范围之外的某些条件（例如 IO）发生阻塞，不会停止执行，程序的其他任务可以继续执行，所以说虽然并发增加了 **上下文切换**（从一个任务切换到另一个任务），性能会下降，但是遇到上面情况实际上加快了。
        - 从性能角度来说，如果没有任务会阻塞，则在单处理机器上使用并发就没有意义了。
    - 设计可管理性

- 实现并发最直接的方式就是在操作系统级别使用进程。**进程**是运行在它自己的地址空间内的自包容程序。操作系统可以周期性的将 CPU 从一个进程切换到另一个进程来实现同时运行多个程序，同时操作系统会将各个进程隔离开，不会相互干涉。
    - 最理想的并发是：每个任务都作为进程在其自己的地址空间内执行，同时各个进程之间没有彼此通信的需要。
- 但是 Java使用的并发系统会共享内存、IO 等，需要协调不同线程驱动任务之间多这些资源的使用，保证这些资源不会同时被多个任务访问。
- Java 是在顺序型语言的基础上提供了线程的支持，线程机制是在有执行程序表示的单一进程中创建任务。

- Java 的线程机制是抢占式的，调度机会周期性的中断线程，将上下文切换到另一个线程，从而为每一个线程都提供时间片，使得每个线程都会分配到数量合理的时间来驱动它的任务。
- 上下文切换的开销通常比抢占式系统的开销要小，同时可以同时执行的线程数量理论上没有任何限制。
- 并发实际：消息系统涉及分布在整个网络中的多台独立的计算机，所有的进程彼此完全独立运行，但是仍然需要在进程之间同步信息，保证整个消息系统不会丢失信息或者在错误的时刻混入信息。